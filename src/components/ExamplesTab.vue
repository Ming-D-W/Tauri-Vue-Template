<template>
  <div class="examples-tab-container">
    <!-- é¡µé¢æ ‡é¢˜ -->
    <div class="header-section">
      <h2>ğŸ¨ ç»„ä»¶ç¤ºä¾‹</h2>
      <p class="description">å±•ç¤º Tauri + Vue 3 çš„å„ç§åŠŸèƒ½å’Œç»„ä»¶ç¤ºä¾‹</p>
    </div>

    <!-- ç¤ºä¾‹åˆ†ç±» -->
    <div class="examples-sections">
      <!-- UI ç»„ä»¶ç¤ºä¾‹ -->
      <section class="example-section">
        <h3>ğŸ“¦ UI ç»„ä»¶ç¤ºä¾‹</h3>
        <div class="example-grid">
          <!-- æŒ‰é’®ç¤ºä¾‹ -->
          <div class="example-card">
            <h4>æŒ‰é’®ç»„ä»¶</h4>
            <div class="example-content">
              <button class="btn btn-primary">ä¸»è¦æŒ‰é’®</button>
              <button class="btn btn-secondary">æ¬¡è¦æŒ‰é’®</button>
              <button class="btn btn-outline">è¾¹æ¡†æŒ‰é’®</button>
              <button class="btn btn-danger">å±é™©æŒ‰é’®</button>
              <button class="btn btn-primary" disabled>ç¦ç”¨æŒ‰é’®</button>
            </div>
          </div>

          <!-- è¾“å…¥æ¡†ç¤ºä¾‹ -->
          <div class="example-card">
            <h4>è¾“å…¥æ¡†ç»„ä»¶</h4>
            <div class="example-content">
              <input v-model="textInput" type="text" class="input" placeholder="æ™®é€šè¾“å…¥æ¡†" />
              <input v-model="passwordInput" type="password" class="input" placeholder="å¯†ç è¾“å…¥æ¡†" />
              <input v-model="numberInput" type="number" class="input" placeholder="æ•°å­—è¾“å…¥æ¡†" />
              <textarea v-model="textareaInput" class="input textarea" placeholder="å¤šè¡Œæ–‡æœ¬"></textarea>
            </div>
          </div>

          <!-- æ¨¡æ€æ¡†ç¤ºä¾‹ -->
          <div class="example-card">
            <h4>æ¨¡æ€æ¡†ç»„ä»¶</h4>
            <div class="example-content">
              <button class="btn btn-primary" @click="showModal = true">æ‰“å¼€æ¨¡æ€æ¡†</button>
              <Modal v-model:visible="showModal">
                <template #header>
                  <h3>ç¤ºä¾‹æ¨¡æ€æ¡†</h3>
                </template>
                <template #body>
                  <p>è¿™æ˜¯ä¸€ä¸ªæ¨¡æ€æ¡†ç¤ºä¾‹å†…å®¹ã€‚</p>
                  <p>æ‚¨å¯ä»¥åœ¨è¿™é‡Œæ”¾ç½®ä»»ä½•å†…å®¹ã€‚</p>
                </template>
                <template #footer>
                  <button class="btn btn-secondary" @click="showModal = false">å…³é—­</button>
                  <button class="btn btn-primary" @click="handleModalConfirm">ç¡®è®¤</button>
                </template>
              </Modal>
            </div>
          </div>

          <!-- Toast é€šçŸ¥ç¤ºä¾‹ -->
          <div class="example-card">
            <h4>Toast é€šçŸ¥</h4>
            <div class="example-content">
              <button class="btn btn-primary" @click="toast.success('æ“ä½œæˆåŠŸï¼')">æˆåŠŸé€šçŸ¥</button>
              <button class="btn btn-danger" @click="toast.error('æ“ä½œå¤±è´¥ï¼')">é”™è¯¯é€šçŸ¥</button>
              <button class="btn btn-secondary" @click="toast.warning('è­¦å‘Šä¿¡æ¯ï¼')">è­¦å‘Šé€šçŸ¥</button>
              <button class="btn btn-outline" @click="toast.info('æç¤ºä¿¡æ¯ï¼')">ä¿¡æ¯é€šçŸ¥</button>
            </div>
          </div>

          <!-- åŠ è½½çŠ¶æ€ç¤ºä¾‹ -->
          <div class="example-card">
            <h4>åŠ è½½çŠ¶æ€</h4>
            <div class="example-content">
              <button class="btn btn-primary" :disabled="isLoading" @click="simulateLoading">
                <span v-if="isLoading">â³ åŠ è½½ä¸­...</span>
                <span v-else>å¼€å§‹åŠ è½½</span>
              </button>
              <div v-if="isLoading" class="loading-spinner"></div>
            </div>
          </div>

          <!-- å¡ç‰‡ç»„ä»¶ç¤ºä¾‹ -->
          <div class="example-card">
            <h4>å¡ç‰‡ç»„ä»¶</h4>
            <div class="example-content">
              <div class="card">
                <div class="card-header">å¡ç‰‡æ ‡é¢˜</div>
                <div class="card-body">
                  <p>è¿™æ˜¯å¡ç‰‡çš„å†…å®¹åŒºåŸŸã€‚</p>
                  <p>å¯ä»¥åŒ…å«ä»»ä½•å†…å®¹ã€‚</p>
                </div>
                <div class="card-footer">
                  <button class="btn btn-sm btn-primary">æ“ä½œ</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Tauri API ç¤ºä¾‹ -->
      <section class="example-section">
        <h3>ğŸ”§ Tauri API ç¤ºä¾‹</h3>
        <div class="example-grid">
          <!-- æ–‡ä»¶é€‰æ‹©å™¨ -->
          <div class="example-card">
            <h4>æ–‡ä»¶é€‰æ‹©å™¨</h4>
            <div class="example-content">
              <button class="btn btn-primary" @click="selectFile">é€‰æ‹©æ–‡ä»¶</button>
              <button class="btn btn-secondary" @click="selectDirectory">é€‰æ‹©ç›®å½•</button>
              <p v-if="selectedPath" class="result-text">å·²é€‰æ‹©: {{ selectedPath }}</p>
            </div>
          </div>

          <!-- æ–‡ä»¶è¯»å†™ -->
          <div class="example-card">
            <h4>æ–‡ä»¶æ“ä½œ</h4>
            <div class="example-content">
              <input v-model="fileContent" type="text" class="input" placeholder="è¾“å…¥æ–‡ä»¶å†…å®¹" />
              <button class="btn btn-primary" @click="saveFile">ä¿å­˜æ–‡ä»¶</button>
              <button class="btn btn-secondary" @click="readFile">è¯»å–æ–‡ä»¶</button>
              <p v-if="readContent" class="result-text">è¯»å–å†…å®¹: {{ readContent }}</p>
            </div>
          </div>

          <!-- ç³»ç»Ÿä¿¡æ¯ -->
          <div class="example-card">
            <h4>ç³»ç»Ÿä¿¡æ¯</h4>
            <div class="example-content">
              <button class="btn btn-primary" @click="getSystemInfo">è·å–ç³»ç»Ÿä¿¡æ¯</button>
              <div v-if="systemInfo" class="info-box">
                <p><strong>æ“ä½œç³»ç»Ÿ:</strong> {{ systemInfo?.os || 'æœªçŸ¥' }}</p>
                <p><strong>æ¶æ„:</strong> {{ systemInfo?.arch || 'æœªçŸ¥' }}</p>
                <p><strong>ç‰ˆæœ¬:</strong> {{ systemInfo?.os_version || 'æœªçŸ¥' }}</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- æ•°æ®æŒä¹…åŒ–ç¤ºä¾‹ -->
      <section class="example-section">
        <h3>ğŸ’¾ æ•°æ®æŒä¹…åŒ–ç¤ºä¾‹</h3>
        <div class="example-grid">
          <!-- LocalStorage -->
          <div class="example-card">
            <h4>LocalStorage</h4>
            <div class="example-content">
              <input v-model="storageValue" type="text" class="input" placeholder="è¾“å…¥è¦ä¿å­˜çš„å€¼" />
              <button class="btn btn-primary" @click="saveToStorage">ä¿å­˜åˆ° LocalStorage</button>
              <button class="btn btn-secondary" @click="loadFromStorage">ä» LocalStorage è¯»å–</button>
              <button class="btn btn-danger" @click="clearStorage">æ¸…é™¤</button>
              <p v-if="loadedValue" class="result-text">è¯»å–çš„å€¼: {{ loadedValue }}</p>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>
</template>

<script setup>
import { ref } from 'vue'
import { api } from '@api'
import Modal from './common/Modal.vue'
import { useToast } from '@composables/useToast'
import { useModal } from '@composables/useModal'
import { useAppStore } from '@stores/app'

// ä½¿ç”¨ composables
const toast = useToast()
const modal = useModal()
const appStore = useAppStore()

// UI ç»„ä»¶çŠ¶æ€
const textInput = ref('')
const passwordInput = ref('')
const numberInput = ref('')
const textareaInput = ref('')
const showModal = ref(false)
const isLoading = ref(false)

// Tauri API çŠ¶æ€
const selectedPath = ref('')
const fileContent = ref('')
const readContent = ref('')
const systemInfo = ref(null)

// LocalStorage çŠ¶æ€
const storageValue = ref('')
const loadedValue = ref('')

// UI ç»„ä»¶æ–¹æ³•
const handleModalConfirm = () => {
  showModal.value = false
  toast.success('å·²ç¡®è®¤ï¼')
}

const simulateLoading = async () => {
  isLoading.value = true
  await new Promise(resolve => setTimeout(resolve, 2000))
  isLoading.value = false
  toast.success('åŠ è½½å®Œæˆï¼')
}

// Tauri API æ–¹æ³•
const selectFile = async () => {
  try {
    const path = await api.file.selectFile()
    if (path) {
      selectedPath.value = path
      toast.success('æ–‡ä»¶å·²é€‰æ‹©')
    }
  } catch (error) {
    toast.error(`é€‰æ‹©æ–‡ä»¶å¤±è´¥: ${error.message}`)
  }
}

const selectDirectory = async () => {
  try {
    const path = await api.file.selectDirectory()
    if (path) {
      selectedPath.value = path
      toast.success('ç›®å½•å·²é€‰æ‹©')
    }
  } catch (error) {
    toast.error(`é€‰æ‹©ç›®å½•å¤±è´¥: ${error.message}`)
  }
}

const saveFile = async () => {
  try {
    if (!fileContent.value) {
      toast.warning('è¯·è¾“å…¥æ–‡ä»¶å†…å®¹')
      return
    }
    await api.file.saveTextFile(fileContent.value)
    toast.success('æ–‡ä»¶å·²ä¿å­˜')
  } catch (error) {
    toast.error(`ä¿å­˜æ–‡ä»¶å¤±è´¥: ${error.message}`)
  }
}

const readFile = async () => {
  try {
    if (!selectedPath.value) {
      toast.warning('è¯·å…ˆé€‰æ‹©æ–‡ä»¶')
      return
    }
    const content = await api.system.readFile(selectedPath.value)
    readContent.value = content
    toast.success('æ–‡ä»¶å·²è¯»å–')
  } catch (error) {
    toast.error(`è¯»å–æ–‡ä»¶å¤±è´¥: ${error.message}`)
  }
}

const getSystemInfo = async () => {
  try {
    systemInfo.value = await api.system.getSystemInfo()
    toast.success('ç³»ç»Ÿä¿¡æ¯å·²è·å–')
  } catch (error) {
    toast.error(`è·å–ç³»ç»Ÿä¿¡æ¯å¤±è´¥: ${error.message}`)
  }
}

// LocalStorage æ–¹æ³•
const saveToStorage = () => {
  try {
    localStorage.setItem('example-value', storageValue.value)
    toast.success('å·²ä¿å­˜åˆ° LocalStorage')
  } catch (error) {
    toast.error(`ä¿å­˜å¤±è´¥: ${error.message}`)
  }
}

const loadFromStorage = () => {
  try {
    loadedValue.value = localStorage.getItem('example-value') || '(æ— æ•°æ®)'
    toast.info('å·²ä» LocalStorage è¯»å–')
  } catch (error) {
    toast.error(`è¯»å–å¤±è´¥: ${error.message}`)
  }
}

const clearStorage = () => {
  try {
    localStorage.removeItem('example-value')
    loadedValue.value = ''
    storageValue.value = ''
    toast.success('å·²æ¸…é™¤ LocalStorage')
  } catch (error) {
    toast.error(`æ¸…é™¤å¤±è´¥: ${error.message}`)
  }
}
</script>

<style scoped>
.examples-tab-container {
  padding: var(--spacing-lg);
  height: 100%;
  overflow-y: auto;
}

.header-section {
  margin-bottom: var(--spacing-lg);
}

.description {
  color: var(--text-secondary);
  margin-top: var(--spacing-sm);
}

.examples-sections {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-xl);
}

.example-section h3 {
  color: var(--text-primary);
  margin-bottom: var(--spacing);
  font-size: var(--font-size-lg);
}

.example-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: var(--spacing);
}

.example-card {
  background: var(--bg-secondary);
  border-radius: var(--radius-md);
  padding: var(--spacing);
  border: 1px solid var(--border-light);
}

.example-card h4 {
  color: var(--text-primary);
  margin-bottom: var(--spacing-sm);
  font-size: var(--font-size);
}

.example-content {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
}

.btn {
  padding: var(--spacing-sm) var(--spacing-md);
  border-radius: var(--radius);
  font-size: var(--font-size-sm);
  font-weight: 500;
  cursor: pointer;
  transition: all var(--transition-fast);
  border: 1px solid transparent;
}

.btn-primary {
  background: var(--primary-color);
  color: white;
}

.btn-secondary {
  background: var(--gray-200);
  color: var(--text-primary);
}

.btn-outline {
  background: transparent;
  color: var(--primary-color);
  border-color: var(--primary-color);
}

.btn-danger {
  background: #dc2626;
  color: white;
}

.btn-sm {
  padding: var(--spacing-xs) var(--spacing-sm);
  font-size: var(--font-size-xs);
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.input {
  padding: var(--spacing-sm);
  border: 1px solid var(--border-light);
  border-radius: var(--radius);
  font-size: var(--font-size-sm);
}

.textarea {
  min-height: 80px;
  resize: vertical;
}

.card {
  background: var(--bg-primary);
  border: 1px solid var(--border-light);
  border-radius: var(--radius);
  overflow: hidden;
}

.card-header {
  padding: var(--spacing-sm);
  background: var(--bg-secondary);
  border-bottom: 1px solid var(--border-light);
  font-weight: 500;
}

.card-body {
  padding: var(--spacing);
}

.card-footer {
  padding: var(--spacing-sm);
  background: var(--bg-secondary);
  border-top: 1px solid var(--border-light);
  text-align: right;
}

.result-text {
  font-size: var(--font-size-sm);
  color: var(--text-secondary);
  padding: var(--spacing-sm);
  background: var(--bg-primary);
  border-radius: var(--radius);
  word-break: break-all;
}

.info-box {
  padding: var(--spacing-sm);
  background: var(--bg-primary);
  border-radius: var(--radius);
  font-size: var(--font-size-sm);
}

.info-box p {
  margin: var(--spacing-xs) 0;
}

.loading-spinner {
  width: 24px;
  height: 24px;
  border: 3px solid var(--border-light);
  border-top-color: var(--primary-color);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}
</style>
